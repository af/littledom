<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>$dom tests</title>
    <style>
        .success { color: green; }
        .success:before { content: 'PASS: ' }

        .fail { color: red; }
        .fail:before { content: 'FAIL: ' }
        #testElements { display: none; }
    </style>
</head>
<body>
    <h1>$dom ghetto test suite</h1>
    <div id="testElements">
        <ol id="listTest">
            <li style="color: red;">1</li>
            <li>2</li>
            <li>3</li>
            <li class="last">4</li>
            <div id="htmlTest">foo</div>
        </ol>
    </div>

    <script src="dollardom.js"></script>
    <script>
        function ensure(description, fn) {
            var reportDiv = document.createElement('div');
            var text = description;
            try {
                fn();
                reportDiv.className = 'success';
            } catch (err) {
                reportDiv.className = 'fail';
                text += (' (' + err.message + ')')
            } finally {
                reportDiv.textContent = text;
                document.body.appendChild(reportDiv);
            }
        }

        function assertEqual(val1, val2) {
            if (val1 !== val2) throw new Error('' + val1 + ' !== ' + val2)
        }
        function QSA(query) {
            return document.querySelectorAll(query);
        }

        ensure('h1 query works', function() {
            assertEqual($dom('h1').length, 1);
            assertEqual($dom('h1')[0].constructor.name, 'HTMLHeadingElement');
        });
        ensure('failed query works', function() {
            assertEqual($dom('h2').length, 0);
        });

        ensure('each method works', function() {
            var count = 0;
            $dom('#listTest > li').each(function(el, idx) { count++; });
            assertEqual(count, 4);
        });
        ensure('map method works', function() {
            var result = $dom('#listTest > li').map(function(el) { return el.innerHTML; });
            assertEqual(result.length, 4);
            result.forEach(function(item, idx) {
                assertEqual(item, String(idx + 1));
            })
        });
        ensure('filter method works', function() {
            var result = $dom('#listTest > li').filter(function(el) { return el.className === 'last'; });
            assertEqual(result.length, 1);
            assertEqual(result[0].innerHTML, '4');
        });

        ensure('html() works on single elements', function() {
            assertEqual($dom('#htmlTest').html(), 'foo');
            $dom('#htmlTest').html('bar');
            assertEqual(QSA('#htmlTest')[0].innerHTML, 'bar');
        });
        ensure('html() works on multiple elements', function() {
            assertEqual($dom('#listTest > li').html(), '1');
            $dom('#listTest > li').html('bar');
            assertEqual(QSA('#listTest > li')[0].innerHTML, 'bar');
            assertEqual(QSA('#listTest > li')[1].innerHTML, 'bar');
            assertEqual(QSA('#listTest > li')[2].innerHTML, 'bar');
            assertEqual(QSA('#listTest > li')[3].innerHTML, 'bar');
        });

        ensure('css() works', function() {
            // Getting style props:
            var selector = '#listTest li:first-child';
            assertEqual($dom(selector).css('color'), 'red');

            // Setting style props:
            $dom(selector).css('color', 'blue');
            assertEqual(QSA(selector)[0].style.color, 'blue');
        });

        ensure('hasClass() works', function() {
            assertEqual($dom('li').hasClass('asdfasdf'), false);
            assertEqual($dom('li').hasClass('last'), true);
        });

        ensure('context argument works', function() {
            var context = QSA('#listTest')[0];
            assertEqual($dom('div', context).length, 1);

            // Shouldn't get any results if we pass in an invalid context:
            assertEqual($dom('div', 123).length, 0);
        });

        // This will do nothing if it fails...
        $dom.ready(function() { ensure('$dom.ready() works', function() {}); });
    </script>
</body>
</html>
