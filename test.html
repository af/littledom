<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>$dom tests</title>
    <style>
        .success { color: green; }
        .success:before { content: 'PASS: ' }

        .fail { color: red; }
        .fail:before { content: 'FAIL: ' }
        #testElements { display: none; }
    </style>
</head>
<body>
    <h1>$dom tests</h1>
    <div id="testElements">
        <ol id="listTest">
            <li>1</li>
            <li>2</li>
            <li>3</li>
            <li class="last">4</li>
            <div id="htmlTest">foo</div>
        </ol>
    </div>

    <script src="dollardom.js"></script>
    <script>
        console.log('starting tests');

        function ensure(description, fn) {
            var reportDiv = document.createElement('div');
            reportDiv.textContent = description;
            try {
                fn();
                reportDiv.className = 'success';
            } catch (err) {
                reportDiv.className = 'fail';
            } finally {
                document.body.appendChild(reportDiv);
            }
        }

        function assert(val) {
            if (!val) throw new Error()
        }
        function QSA(query) {
            return document.querySelectorAll(query);
        }

        ensure('h1 query works', function() {
            assert($dom('h1').length === 1);
            assert($dom('h1')[0].constructor.name === 'HTMLHeadingElement');
        });
        ensure('failed query works', function() {
            assert($dom('h2').length === 0);
        });
        ensure('each method works', function() {
            var count = 0;
            $dom('#listTest > li').each(function(el, idx) { count++; });
            assert(count === 4);
        });
        ensure('map method works', function() {
            var result = $dom('#listTest > li').map(function(el) { return el.innerHTML; });
            assert(result.length === 4);
            result.forEach(function(item, idx) {
                assert(item === String(idx + 1));
            })
        });
        ensure('filter method works', function() {
            var result = $dom('#listTest > li').filter(function(el) { return el.className === 'last'; });
            assert(result.length === 1);
            assert(result[0].innerHTML === '4');
        });
        ensure('html() works on single elements', function() {
            assert($dom('#htmlTest').html() === 'foo');
            $dom('#htmlTest').html('bar');
            assert(QSA('#htmlTest')[0].innerHTML === 'bar');
        });
        ensure('html() works on multiple elements', function() {
            assert($dom('#listTest > li').html() === '1');
            $dom('#listTest > li').html('bar');
            assert(QSA('#listTest > li')[0].innerHTML === 'bar');
            assert(QSA('#listTest > li')[1].innerHTML === 'bar');
            assert(QSA('#listTest > li')[2].innerHTML === 'bar');
            assert(QSA('#listTest > li')[3].innerHTML === 'bar');
        });
    </script>
</body>
</html>
